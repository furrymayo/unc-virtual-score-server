<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap">
    <title>{% block title %}UDP OES Data Viewer{% endblock %}</title>

    <style>
        :root {
            --ink: #e7f0ff;
            --ink-soft: #a7bdd9;
            --navy: #0b1527;
            --navy-soft: #122742;
            --surface: #0f213d;
            --surface-soft: #142c4a;
            --carolina: #4b9cd3;
            --carolina-soft: #83c6f2;
            --accent: #f4c27a;
            --shadow: rgba(3, 8, 18, 0.55);
        }

        body {
            font-family: "Space Grotesk", system-ui, sans-serif;
            background: radial-gradient(circle at 18% 15%, rgba(75, 156, 211, 0.35) 0%, transparent 45%),
                        radial-gradient(circle at 85% 10%, rgba(131, 198, 242, 0.2) 0%, transparent 45%),
                        linear-gradient(140deg, #0b1527 0%, #0f1f36 45%, #112a46 100%);
            color: var(--ink);
            min-height: 100vh;
        }

        #navbar {
            flex-direction: column;
            background: var(--navy);
            box-shadow: 0 12px 30px var(--shadow);
        }

        .navbar-brand {
            font-weight: 700;
            letter-spacing: 0.02em;
            color: var(--ink);
        }

        .navbar-dark .navbar-nav .nav-link {
            color: var(--ink-soft);
            font-weight: 500;
        }

        .navbar-dark .navbar-nav .nav-link:hover,
        .navbar-dark .navbar-nav .nav-link:focus {
            color: var(--carolina-soft);
        }

        .config-panel {
            background: rgba(15, 33, 61, 0.9);
            border: 1px solid rgba(131, 198, 242, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--ink);
        }

        .config-panel label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 4px;
            display: block;
            color: var(--ink-soft);
        }

        .config-panel input,
        .config-panel select {
            width: 100%;
            border-radius: 8px;
            border: 1px solid rgba(131, 198, 242, 0.25);
            background: rgba(8, 18, 34, 0.7);
            color: var(--ink);
            padding: 6px 8px;
            font-size: 0.9rem;
        }

        .config-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }

        .btn-config {
            background: var(--carolina);
            border: none;
            color: var(--navy);
            font-weight: 600;
            padding: 8px 14px;
            border-radius: 999px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-config:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(75, 156, 211, 0.45);
        }

        .content-shell {
            padding-top: 28px;
            padding-bottom: 40px;
        }

        .scoreboard-shell {
            background: linear-gradient(140deg, rgba(15, 33, 61, 0.96), rgba(20, 44, 74, 0.95));
            border-radius: 24px;
            border: 1px solid rgba(131, 198, 242, 0.18);
            padding: 24px;
            box-shadow: 0 20px 50px var(--shadow);
            backdrop-filter: blur(6px);
            position: relative;
            overflow: hidden;
            animation: rise-in 0.6s ease-out both;
            font-size: 1.6rem;
            transform: scale(1.5);
            transform-origin: top center;
        }

        .scoreboard-shell::before {
            content: "";
            position: absolute;
            inset: -30% 50% auto -10%;
            height: 180px;
            background: radial-gradient(circle, rgba(75, 156, 211, 0.35), transparent 70%);
            opacity: 0.6;
            pointer-events: none;
        }

        .scoreboard-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 20px;
        }

        .scoreboard-title {
            font-size: clamp(1.6rem, 3vw, 2.2rem);
            font-weight: 700;
            letter-spacing: 0.02em;
        }

        .scoreboard-subtitle {
            font-size: 0.85rem;
            color: var(--ink-soft);
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .meta-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .meta-chip {
            background: var(--navy-soft);
            color: var(--ink);
            border-radius: 999px;
            padding: 4px 12px;
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(131, 198, 242, 0.18);
        }

        .meta-chip span {
            font-weight: 600;
            font-family: "JetBrains Mono", monospace;
            letter-spacing: 0.02em;
            text-transform: none;
        }

        .score-grid {
            display: grid;
            grid-template-columns: 1fr minmax(140px, 220px) 1fr;
            gap: 16px;
            align-items: center;
            margin-bottom: 20px;
        }

        .team-card {
            background: linear-gradient(135deg, rgba(18, 39, 66, 0.95), rgba(20, 52, 82, 0.9));
            border-radius: 18px;
            padding: 16px;
            border: 1px solid rgba(131, 198, 242, 0.14);
            box-shadow: 0 10px 24px rgba(4, 12, 24, 0.3);
        }

        .team-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.22em;
            color: var(--ink-soft);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .team-label.is-home,
        .team-label.is-visitor {
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .team-label.is-home {
            color: var(--carolina-soft);
        }

        .team-label.is-visitor {
            color: #ffffff;
        }

        .team-score {
            font-size: clamp(2rem, 4vw, 3.5rem);
            font-weight: 700;
            font-family: "JetBrains Mono", monospace;
            letter-spacing: 0.02em;
            text-align: center;
            color: var(--carolina-soft);
        }

        .team-meta {
            margin-top: 12px;
            display: grid;
            gap: 6px;
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-line span {
            font-size: 0.65rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--ink-soft);
        }

        .stat-line strong {
            font-size: 0.95rem;
            font-weight: 600;
            font-family: "JetBrains Mono", monospace;
        }

        .possession-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(231, 240, 255, 0.2);
        }

        .possession-dot.is-active {
            background: var(--carolina);
            box-shadow: 0 0 0 4px rgba(75, 156, 211, 0.25);
        }

        .center-card {
            background: var(--navy);
            color: var(--ink);
            border-radius: 18px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 16px 30px rgba(4, 10, 22, 0.45);
        }

        .center-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.22em;
            color: rgba(231, 240, 255, 0.6);
        }

        .center-value {
            font-size: clamp(1.6rem, 3vw, 2.4rem);
            font-weight: 700;
            font-family: "JetBrains Mono", monospace;
        }

        .center-value.emphasis {
            font-size: clamp(2.2rem, 4vw, 3.2rem);
        }

        .clock-critical {
            color: #ff6b6b;
        }

        .center-divider {
            height: 1px;
            background: rgba(131, 198, 242, 0.18);
            margin: 10px 0;
        }

        .team-divider {
            height: 1px;
            background: rgba(131, 198, 242, 0.16);
            margin: 10px 0 12px;
        }

        .basketball-scoreboard .team-label {
            font-size: 1rem;
            font-weight: 700;
        }

        .basketball-scoreboard .team-score {
            font-size: clamp(2.4rem, 4.8vw, 4.2rem);
            font-weight: 800;
        }

        .basketball-scoreboard .center-value.emphasis {
            font-size: clamp(2.8rem, 5.4vw, 4.6rem);
        }

        .basketball-scoreboard .center-value.period-small {
            font-size: clamp(1.2rem, 2.6vw, 1.8rem);
        }

        .basketball-scoreboard .center-label.shot-label {
            font-size: 0.8rem;
            letter-spacing: 0.24em;
        }

        .basketball-scoreboard .center-value.shot-value {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 800;
        }

        .basketball-scoreboard .stat-line strong {
            font-size: 1.1rem;
        }

        .basketball-scoreboard .stat-line span {
            font-size: 0.7rem;
        }

        .diamond-sport .team-score {
            font-size: clamp(1.8rem, 3.2vw, 3rem);
        }

        .diamond-sport .team-meta .stat-line strong {
            font-size: 0.95rem;
        }

        .diamond-divider {
            height: 1px;
            background: rgba(131, 198, 242, 0.16);
            margin: 10px 0 12px;
        }

        .count-row {
            display: grid;
            grid-template-columns: minmax(180px, 220px) 1fr;
            gap: 16px;
            align-items: stretch;
            margin: 18px 0 8px;
        }

        .count-row .center-card {
            padding: 14px;
        }

        @media (max-width: 768px) {
            .count-row {
                grid-template-columns: 1fr;
            }
        }

        .center-value.compact {
            font-size: clamp(1.1rem, 2vw, 1.6rem);
        }

        .center-label.compact {
            font-size: 0.6rem;
            letter-spacing: 0.18em;
        }

        .count-bar {
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
            margin: 18px 0 8px;
            flex-wrap: wrap;
        }

        .count-pill {
            background: rgba(11, 21, 39, 0.85);
            border: 1px solid rgba(131, 198, 242, 0.2);
            border-radius: 14px;
            padding: 10px 16px;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(3, 9, 18, 0.35);
        }

        .count-label {
            font-size: 0.65rem;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: var(--ink-soft);
        }

        .count-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: "JetBrains Mono", monospace;
            color: var(--carolina-soft);
        }

        .diamond-sport .team-meta .stat-line strong {
            font-size: 0.85rem;
        }

        .trackman-shell {
            background: rgba(11, 21, 39, 0.6);
            border: 1px solid rgba(131, 198, 242, 0.18);
            border-radius: 18px;
            padding: 12px;
            width: 100%;
        }

        .trackman-grid {
            display: grid;
            gap: 8px;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .trackman-card {
            position: relative;
            background: rgba(18, 34, 56, 0.95);
            border: 1px solid rgba(131, 198, 242, 0.16);
            border-radius: 14px;
            padding: 8px 10px;
            overflow: hidden;
            min-height: 68px;
        }

        .trackman-card::after {
            content: "";
            position: absolute;
            right: -10px;
            top: -10px;
            width: 90px;
            height: 90px;
            background: radial-gradient(circle, rgba(131, 198, 242, 0.18), transparent 65%);
            opacity: 0.7;
        }

        .trackman-label {
            font-size: 0.6rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--carolina-soft);
            font-weight: 700;
        }

        .trackman-value {
            font-size: 1.3rem;
            font-weight: 700;
            font-family: "JetBrains Mono", monospace;
            margin-top: 8px;
        }

        .trackman-unit {
            font-size: 0.65rem;
            color: var(--ink-soft);
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .trackman-section-label {
            font-size: 0.55rem;
            letter-spacing: 0.24em;
            text-transform: uppercase;
            color: var(--ink-soft);
            margin: 2px 0 6px;
        }

        .trackman-meta {
            display: grid;
            gap: 8px;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            margin-top: 12px;
        }

        .trackman-config-compact {
            padding: 4px 8px;
        }

        .trackman-config-compact .config-grid {
            gap: 8px;
        }

        .trackman-config-compact label {
            font-size: 0.6rem;
        }

        .trackman-config-compact .meta-chip {
            padding: 2px 8px;
            font-size: 0.6rem;
        }

        .trackman-config-compact input,
        .trackman-config-compact select {
            padding: 3px 6px;
            font-size: 0.75rem;
        }

        .trackman-config-compact .btn-config {
            padding: 3px 8px;
            font-size: 0.7rem;
        }

        .score-trackman-layout {
            display: grid;
            grid-template-columns: minmax(360px, 1.2fr) 1.8fr;
            gap: 18px;
            align-items: start;
            margin-top: 16px;
        }

        .trackman-zone {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }

        .zone-canvas {
            position: relative;
            width: 100%;
            aspect-ratio: 4 / 3;
            border: 1px solid rgba(131, 198, 242, 0.35);
            border-radius: 10px;
            background: rgba(8, 18, 34, 0.6);
            overflow: hidden;
            margin: 6px auto 4px;
        }

        .zone-grid {
            position: absolute;
            width: 50%;
            height: 84%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid rgba(131, 198, 242, 0.55);
            border-radius: 6px;
            pointer-events: none;
        }

        .zone-line {
            position: absolute;
            background: rgba(131, 198, 242, 0.22);
        }

        .zone-line.v {
            top: 0;
            bottom: 0;
            width: 1px;
        }

        .zone-line.v.v1 {
            left: 33.333%;
        }

        .zone-line.v.v2 {
            left: 66.666%;
        }

        .zone-line.h {
            left: 0;
            right: 0;
            height: 1px;
        }

        .zone-line.h.h1 {
            top: 33.333%;
        }

        .zone-line.h.h2 {
            top: 66.666%;
        }

        .zone-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--carolina);
            box-shadow: 0 0 0 3px rgba(75, 156, 211, 0.25);
            transform: translate(-50%, -50%);
            left: 50%;
            top: 50%;
            pointer-events: none;
        }

        .trackman-card.trackman-zone {
            padding: 10px 12px 14px;
            min-height: 240px;
        }


        @media (max-width: 992px) {
            .score-trackman-layout {
                grid-template-columns: 1fr;
            }
        }

        .stat-grid {
            display: grid;
            gap: 12px;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        }

        .stat-card {
            background: rgba(16, 35, 60, 0.9);
            border-radius: 14px;
            padding: 12px 14px;
            border: 1px solid rgba(131, 198, 242, 0.14);
            box-shadow: 0 8px 16px rgba(3, 9, 18, 0.35);
        }

        .stat-label {
            font-size: 0.65rem;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: var(--ink-soft);
        }

        .stat-value {
            font-size: 1.05rem;
            font-weight: 600;
            font-family: "JetBrains Mono", monospace;
        }

        .badge-soft {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(75, 156, 211, 0.22);
            color: var(--ink);
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .badge-muted {
            background: rgba(231, 240, 255, 0.12);
            color: var(--ink-soft);
        }

        .section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--ink-soft);
            margin: 18px 0 10px;
        }

        .table-card {
            background: rgba(11, 21, 39, 0.7);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid rgba(131, 198, 242, 0.14);
        }

        .table-grid {
            width: 100%;
            border-collapse: collapse;
        }

        .table-grid th,
        .table-grid td {
            padding: 6px 8px;
            text-align: center;
            font-family: "JetBrains Mono", monospace;
        }

        .table-grid th {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--ink-soft);
        }

        .table-grid td {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .table-grid tbody tr {
            border-top: 1px solid rgba(131, 198, 242, 0.1);
        }

        .table-grid tbody tr:nth-child(odd) td {
            background: rgba(11, 21, 39, 0.5);
        }

        .linescore-total {
            background: rgba(75, 156, 211, 0.18);
            color: var(--ink);
            font-weight: 700;
        }

        .linescore-label {
            color: var(--carolina-soft);
            font-weight: 700;
        }

        .team-row-label {
            text-align: left;
            font-family: "Space Grotesk", sans-serif;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .score-grid {
                grid-template-columns: 1fr;
            }

            .center-card {
                order: -1;
            }
        }

        @media (max-width: 576px) {
            .scoreboard-shell {
                padding: 18px;
                font-size: 1.3rem;
                transform: scale(1.25);
            }

            .meta-row {
                width: 100%;
                justify-content: flex-start;
            }

            .meta-chip {
                flex: 1 1 auto;
                justify-content: center;
            }
        }

        @keyframes rise-in {
            from {
                opacity: 0;
                transform: translateY(12px) scale(1.35);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1.5);
            }
        }
    </style>
    <script>
        function fetchData(sport) {
            fetch(`/get_raw_data/${sport}`, { cache: "no-store" })
                .then(response => response.json())
                .then(data => {
                    const event = new CustomEvent('dataFetched', { detail: data });
                    document.dispatchEvent(event);
                })
                .catch(error => console.error('Error:', error));
        }

        function formatValue(value, fallback) {
            if (fallback === undefined) {
                fallback = "n/a";
            }
            if (value === undefined || value === null || value === "") {
                return fallback;
            }
            if (typeof value === "number" && Number.isNaN(value)) {
                return fallback;
            }
            return value;
        }

        function setText(id, value, fallback) {
            const el = document.getElementById(id);
            if (!el) {
                return;
            }
            el.textContent = formatValue(value, fallback);
        }

        function setPossession(homeId, visitorId, possession) {
            const homeDot = document.getElementById(homeId);
            const visitorDot = document.getElementById(visitorId);
            if (!homeDot || !visitorDot) {
                return;
            }
            homeDot.classList.toggle("is-active", possession === "home");
            visitorDot.classList.toggle("is-active", possession === "visitor");
        }

        function updateStrikeZone(dotId, readoutId, data, options) {
            const dot = document.getElementById(dotId);
            const readout = document.getElementById(readoutId);
            if (!dot || !readout) {
                return;
            }

            const canvas = dot.closest('.zone-canvas');
            const grid = canvas ? canvas.querySelector('.zone-grid') : null;
            if (!canvas || !grid) {
                return;
            }

            const rawX = parseFloat(data.plate_x);
            const rawY = parseFloat(data.plate_y);
            const rawZ = parseFloat(data.plate_z);
            const vertical = Number.isFinite(rawY) ? rawY : rawZ;

            if (!Number.isFinite(rawX) || !Number.isFinite(vertical)) {
                dot.style.display = 'none';
                readout.textContent = 'n/a';
                return;
            }

            const zone = (options && options.zone) || { minX: -0.83, maxX: 0.83, minV: 1.5, maxV: 3.3775 };
            const margin = (options && options.margin) || 1.0;
            const minX = zone.minX;
            const maxX = zone.maxX;
            const minV = zone.minV;
            const maxV = zone.maxV;

            const canvasRect = canvas.getBoundingClientRect();
            const gridRect = grid.getBoundingClientRect();
            const gridLeft = gridRect.left - canvasRect.left;
            const gridTop = gridRect.top - canvasRect.top;
            const gridWidth = gridRect.width;
            const gridHeight = gridRect.height;

            const zoneWidth = maxX - minX;
            const zoneHeight = maxV - minV;
            const xOffset = (options && options.xOffset) || 0;
            const xScale = (options && options.xScale) || 1;
            const scaleX = gridWidth / zoneWidth;
            const scaleZ = gridHeight / zoneHeight;
            const centerX = gridLeft + gridWidth / 2;
            const centerY = gridTop + gridHeight / 2;
            const zoneCenterV = (minV + maxV) / 2;

            const px = centerX + (rawX - xOffset) * scaleX * xScale;
            const pz = centerY - (vertical - zoneCenterV) * scaleZ;

            const width = canvas.clientWidth || 1;
            const height = canvas.clientHeight || 1;
            const clampedX = Math.max(0, Math.min(width, px));
            const clampedZ = Math.max(0, Math.min(height, pz));

            dot.style.display = 'block';
            dot.style.left = `${clampedX}px`;
            dot.style.top = `${clampedZ}px`;

            const yText = Number.isFinite(rawY) ? `Y ${rawY.toFixed(2)} ft` : '';
            const zText = Number.isFinite(rawZ) ? `Z ${rawZ.toFixed(2)} ft` : '';
            readout.textContent = `X ${rawX.toFixed(2)} ft${yText ? ` · ${yText}` : ''}${zText ? ` · ${zText}` : ''}`;
        }
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" id="navbar">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbar">
            <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between w-100">
                <a class="navbar-brand mb-3 mb-lg-0" href="/">Virtual Scoreboard Hub</a>
            </div>

            <div class="links">
                <div class="navbar-nav">
                    <a class="nav-item nav-link" id="Basketball" href="/Basketball">Basketball</a>
                    <a class="nav-item nav-link" id="Hockey" href="/Hockey">Hockey</a>
                    <a class="nav-item nav-link" id="Lacrosse" href="/Lacrosse">Lacrosse</a>
                    <a class="nav-item nav-link" id="Football" href="/Football">Football</a>
                    <a class="nav-item nav-link" id="Volleyball" href="/Volleyball">Volleyball</a>
                    <a class="nav-item nav-link" id="Wrestling" href="/Wrestling">Wrestling</a>
                    <a class="nav-item nav-link" id="Soccer" href="/Soccer">Soccer</a>
                    <a class="nav-item nav-link" id="Softball" href="/Softball">Softball</a>
                    <a class="nav-item nav-link" id="Baseball" href="/Baseball">Baseball</a>
                    <a class="nav-item nav-link" id="Gymnastics" href="/Gymnastics">Gymnastics</a>
                    <a class="nav-item nav-link" id="Debug" href="/Debug">DEBUG</a>
                    <!-- Add more buttons for other sports -->
                </div>
            </div>
        </div>
    </nav>
    <div class="container content-shell">
        {% block content %}{% endblock %}
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
</html>
