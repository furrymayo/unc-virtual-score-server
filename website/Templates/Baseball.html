{% extends "base.html" %}
{% block title %}Baseball Scoreboard{% endblock %}
{% block container_class %}container-fluid{% endblock %}

{% block content %}
<style>
    /* === Baseball-specific layout overrides (font sizing now in base.html) === */

    /* Score-trackman 3-column layout — center gets more share */
    .baseball-scoreboard .score-trackman-layout.has-strike-zone {
        grid-template-columns: minmax(180px, 15vw) 1fr minmax(180px, 15vw);
        gap: clamp(10px, 1vw, 18px);
        align-items: stretch;
    }

    /* Count bar: single row, no wrap */
    .baseball-scoreboard .count-bar {
        margin: 0;
        flex-wrap: nowrap;
    }

    /* Center column: flex column so linescore gets remaining space */
    .baseball-scoreboard .center-col {
        display: flex;
        flex-direction: column;
        min-height: 0;
    }

    /* Top row: Pitching | Inning | At Bat */
    .baseball-scoreboard .info-top-row {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: clamp(6px, 0.8vw, 12px);
        align-items: stretch;
    }

    /* Section title tighter margins */
    .baseball-scoreboard .section-title {
        margin: clamp(4px, 0.6vh, 10px) 0;
    }

    /* TrackMan + Strike Zone columns: stretch to match center column height */
    .baseball-scoreboard .trackman-column {
        max-width: none;
        display: flex;
        flex-direction: column;
    }

    .baseball-scoreboard .trackman-column .trackman-shell {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .baseball-scoreboard .strikezone-column {
        max-width: none;
        display: flex;
        flex-direction: column;
    }

    .baseball-scoreboard .strikezone-column .trackman-shell {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .baseball-scoreboard .strikezone-column .trackman-card.trackman-zone {
        flex: 1;
        min-height: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .baseball-scoreboard .strikezone-column .zone-canvas {
        flex: 0 0 auto;
        width: 100%;
        max-width: 100%;
        aspect-ratio: 3 / 4;
    }

    /* Linescore in center column */
    .baseball-scoreboard .linescore-full {
        margin-top: clamp(4px, 0.5vh, 8px);
    }

    /* Score-count row: team | B/S/O pills | team */
    .baseball-scoreboard .score-count-row {
        display: grid;
        grid-template-columns: minmax(60px, 0.18fr) 1fr minmax(60px, 0.18fr);
        gap: clamp(6px, 0.8vw, 12px);
        align-items: stretch;
    }

    /* Compact team cards in score row */
    .baseball-scoreboard .score-count-row .team-card {
        padding: clamp(2px, 0.4vh, 8px);
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .baseball-scoreboard .score-count-row .team-label {
        font-size: clamp(0.8rem, 1vw, 1.4rem);
        justify-content: center;
    }
    .baseball-scoreboard .score-count-row .team-score {
        font-size: clamp(2rem, 3vw, 4.5rem);
    }

    /* Compact center cards in top row */
    .baseball-scoreboard .info-top-row .center-card {
        padding: clamp(6px, 0.8vh, 12px);
    }

    /* TrackMan: shrink labels, let values scale within card */
    .baseball-scoreboard .trackman-label {
        font-size: clamp(0.55rem, 0.7vw, 0.9rem);
    }
    .baseball-scoreboard .trackman-unit {
        font-size: clamp(0.55rem, 0.7vw, 0.9rem);
    }
    .baseball-scoreboard .trackman-value {
        font-size: clamp(1.4rem, 2vw, 2.8rem);
        text-align: center;
        margin-top: 2px;
    }

    /* Balls/Strikes/Outs: pronounced cards with glow */
    .baseball-scoreboard .count-pill {
        padding: clamp(8px, 1vh, 16px) clamp(12px, 1.5vw, 28px);
        min-width: clamp(100px, 10vw, 180px);
        background: linear-gradient(
            145deg,
            rgba(15, 42, 82, 0.95) 0%,
            rgba(20, 55, 100, 0.92) 50%,
            rgba(18, 48, 88, 0.95) 100%
        );
        border: 1px solid rgba(75, 156, 211, 0.45);
        box-shadow:
            inset 0 1px 1px rgba(131, 198, 242, 0.08),
            0 0 8px rgba(75, 156, 211, 0.25),
            0 0 20px rgba(75, 156, 211, 0.15),
            0 8px 24px rgba(3, 9, 18, 0.4);
    }
    .baseball-scoreboard .count-value {
        font-size: clamp(2.8rem, 4.5vw, 6.5rem);
        color: #ffffff;
        text-shadow:
            0 0 12px rgba(75, 156, 211, 0.5),
            0 0 24px rgba(75, 156, 211, 0.2);
    }
    .baseball-scoreboard .count-label {
        font-size: clamp(1rem, 1.6vw, 2.2rem);
        font-weight: 700;
        color: rgba(131, 198, 242, 0.85);
        text-shadow: 0 0 8px rgba(75, 156, 211, 0.15);
    }

    /* Pitching/At Bat cards: +15px */
    .baseball-scoreboard .info-top-row .center-label {
        font-size: clamp(0.8rem, 1.2vw, 1.8rem);
    }
    .baseball-scoreboard .center-value.compact {
        font-size: clamp(1.4rem, 2.2vw, 3rem);
    }
    .baseball-scoreboard .stat-value.compact {
        font-size: clamp(1.1rem, 1.8vw, 2.4rem);
    }

    /* Linescore team name: short code, constrained width */
    .baseball-scoreboard .team-row-label {
        font-size: clamp(1.4rem, 1.8vw, 2.4rem);
        text-align: left;
        max-width: 6ch;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* Inning headers */
    .baseball-scoreboard .table-grid th {
        font-size: clamp(1.35rem, 1.8vw, 2.4rem);
    }

    /* Inning data */
    .baseball-scoreboard .table-grid td {
        font-size: clamp(1.6rem, 2.2vw, 3rem);
    }

    /* R/H/E card: visual separation */
    .baseball-scoreboard .linescore-total,
    .baseball-scoreboard .linescore-label {
        font-size: clamp(1.9rem, 2.8vw, 3.5rem) !important;
        font-weight: 700;
        background: linear-gradient(135deg, rgba(18, 39, 66, 0.95), rgba(20, 52, 82, 0.9)) !important;
    }
    .baseball-scoreboard .table-grid th:nth-last-child(3),
    .baseball-scoreboard .table-grid td:nth-last-child(3) {
        border-left: 3px solid var(--carolina);
        padding-left: 12px;
    }

    /* Config panel reduced margin */
    .baseball-scoreboard ~ details.data-sources-panel {
        margin-top: 8px;
    }
</style>

<section class="scoreboard-shell diamond-sport baseball-scoreboard">
    <div class="scoreboard-header">
        <div>
            <div class="scoreboard-title">Baseball</div>
            <div class="scoreboard-subtitle" id="bs-venue-info">Live scoreboard feed</div>
        </div>
        <div class="meta-row">
            <div class="meta-chip" id="bs-weather-chip" style="display: none;"><span id="bs-weather">--</span></div>
        </div>
    </div>

    <div class="score-trackman-layout has-strike-zone">
        <div class="trackman-column">
            <div class="section-title">TrackMan</div>
            <div class="trackman-shell">
                <div class="trackman-section-label">Pitching</div>
                <div class="trackman-grid">
                    <div class="trackman-card">
                        <div class="trackman-label">Release Speed</div>
                        <div class="trackman-value" id="bs-tm-pitch-speed">n/a</div>
                        <div class="trackman-unit">MPH</div>
                    </div>
                    <div class="trackman-card">
                        <div class="trackman-label">Spin Rate</div>
                        <div class="trackman-value" id="bs-tm-spin-rate">n/a</div>
                        <div class="trackman-unit">RPM</div>
                    </div>
                </div>
                <div class="trackman-section-label" style="margin-top: 8px;">Batting</div>
                <div class="trackman-grid">
                    <div class="trackman-card">
                        <div class="trackman-label">Exit Speed</div>
                        <div class="trackman-value" id="bs-tm-exit-velocity">n/a</div>
                        <div class="trackman-unit">MPH</div>
                    </div>
                    <div class="trackman-card">
                        <div class="trackman-label">Launch Angle</div>
                        <div class="trackman-value" id="bs-tm-launch-angle">n/a</div>
                        <div class="trackman-unit">DEG</div>
                    </div>
                    <div class="trackman-card">
                        <div class="trackman-label">Distance</div>
                        <div class="trackman-value" id="bs-tm-distance">n/a</div>
                        <div class="trackman-unit">FT</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="center-col">
            <div class="info-top-row">
                <div class="center-card compact">
                    <div class="center-label">Pitching</div>
                    <div class="center-value compact" id="bs-current-pitcher">--</div>
                    <div class="stat-value compact" id="bs-pitcher-line" style="color: var(--ink-soft);">--</div>
                </div>
                <div class="center-card compact" style="text-align: center;">
                    <div class="base-diamond">
                        <div class="base-diamond-shape"></div>
                        <div class="base-marker base-first" id="bs-base-1"></div>
                        <div class="base-marker base-second" id="bs-base-2"></div>
                        <div class="base-marker base-third" id="bs-base-3"></div>
                    </div>
                    <div class="center-value" id="bs-half-inning">n/a</div>
                </div>
                <div class="center-card compact">
                    <div class="center-label">At Bat</div>
                    <div class="center-value compact" id="bs-current-batter">--</div>
                    <div class="stat-value compact" id="bs-batter-line" style="color: var(--ink-soft);">--</div>
                </div>
            </div>

            <div class="score-count-row" style="margin-top: clamp(4px, 0.5vh, 8px);">
                <div class="team-card team-away">
                    <div class="team-label"><span id="bs-away-name">Away</span></div>
                    <div class="team-score" id="bs-away-runs">--</div>
                </div>
                <div class="count-bar">
                    <div class="count-pill">
                        <div class="count-label">Balls</div>
                        <div class="count-value" id="bs-balls">--</div>
                    </div>
                    <div class="count-pill">
                        <div class="count-label">Strikes</div>
                        <div class="count-value" id="bs-strikes">--</div>
                    </div>
                    <div class="count-pill">
                        <div class="count-label">Outs</div>
                        <div class="count-value" id="bs-outs">--</div>
                    </div>
                </div>
                <div class="team-card team-home">
                    <div class="team-label"><span id="bs-home-name">Home</span></div>
                    <div class="team-score" id="bs-home-runs">--</div>
                </div>
            </div>

            <div class="linescore-full">
                <div class="section-title">Innings</div>
                <div class="table-card">
                    <div id="bs-linescore-table"></div>
                </div>
            </div>
        </div>
        <div class="strikezone-column">
            <div class="section-title">Strike Zone</div>
            <div class="trackman-shell">
                <div class="trackman-card trackman-zone">
                    <div class="trackman-label">Strike Zone</div>
                    <div class="zone-canvas">
                        <div class="zone-grid">
                            <div class="zone-line v v1"></div>
                            <div class="zone-line v v2"></div>
                            <div class="zone-line h h1"></div>
                            <div class="zone-line h h2"></div>
                        </div>
                        <div class="zone-dot" id="bs-zone-dot"></div>
                    </div>
                    <div class="trackman-unit" id="bs-zone-readout">n/a</div>
                </div>
            </div>
        </div>
    </div>

</section>

<details class="trackman-shell trackman-config-compact data-sources-panel" style="margin-top: 8px;">
    <summary class="scoreboard-header" style="margin-bottom: 10px; cursor: pointer;">
        <div style="display: flex; align-items: center;">
            <span class="dropdown-indicator"></span>
            <div class="scoreboard-subtitle">Additional Data Sources</div>
        </div>
        <div class="meta-row">
            <div class="meta-chip">TrackMan <span id="bs-tm-status">n/a</span></div>
            <div class="meta-chip">StatCrew <span id="bs-sc-status">n/a</span></div>
        </div>
    </summary>

    <div class="section-title" style="margin-top: 8px; margin-bottom: 8px;">TrackMan UDP</div>
    <form id="bs-trackman-form" class="config-grid">
        <div>
            <label for="bs-trackman-port">UDP Port</label>
            <input id="bs-trackman-port" type="number" min="1" max="65535" placeholder="20998" />
        </div>
        <div>
            <label for="bs-trackman-feed-type">Feed Type</label>
            <select id="bs-trackman-feed-type">
                <option value="broadcast">Broadcast (Pitch + Hit, UDP 20998)</option>
                <option value="scoreboard">Scoreboard (Pitch OR Hit, UDP 20999)</option>
            </select>
        </div>
        <div>
            <label for="bs-trackman-enabled">Enabled</label>
            <select id="bs-trackman-enabled">
                <option value="true">Enabled</option>
                <option value="false">Disabled</option>
            </select>
        </div>
        <div class="d-flex align-items-end">
            <button type="submit" class="btn-config w-100">Save TrackMan</button>
        </div>
    </form>

    <div class="section-title" style="margin-top: 12px; margin-bottom: 8px;">StatCrew XML</div>
    <form id="bs-statcrew-form" class="config-grid">
        <div style="grid-column: span 2;">
            <label for="bs-statcrew-path">StatCrew XML File Path</label>
            <div class="path-input-group">
                <input id="bs-statcrew-path" type="text" placeholder="/path/to/statcrew.xml" />
                <button type="button" class="btn-browse" onclick="openFileBrowser('bs-statcrew-path')">Browse</button>
            </div>
        </div>
        <div>
            <label for="bs-statcrew-enabled">Enabled</label>
            <select id="bs-statcrew-enabled">
                <option value="true">Enabled</option>
                <option value="false">Disabled</option>
            </select>
        </div>
        <div class="d-flex align-items-end">
            <button type="submit" class="btn-config w-100">Save StatCrew</button>
        </div>
    </form>
</details>

<script>
    let statcrewData = {};
    let currentHalf = '';  // TOP, MID, BOT, END from OES inning state

    // Returns which team is batting: 'away' or 'home'.
    // Prefers StatCrew XML (batting_team) over OES half-inning state.
    function getBattingTeam() {
        if (statcrewData.batting_team) return statcrewData.batting_team;
        if (currentHalf === 'TOP' || currentHalf === 'MID') return 'away';
        if (currentHalf === 'BOT' || currentHalf === 'END') return 'home';
        return '';
    }

    function renderBaseball(data) {
        setText('bs-balls', data.balls);
        setText('bs-strikes', data.strikes);
        setText('bs-outs', data.outs);
        setText('bs-away-runs', data.away_runs);
        setText('bs-home-runs', data.home_runs);

        const awayInnings = Array.isArray(data.away_innings) ? data.away_innings : [];
        const homeInnings = Array.isArray(data.home_innings) ? data.home_innings : [];

        const awayLabel = 'Away';
        const homeLabel = 'Home';

        renderLinescoreBaseball(awayInnings, homeInnings, {
            away: { runs: data.away_runs, hits: data.away_hits, errors: data.away_errors, label: awayLabel },
            home: { runs: data.home_runs, hits: data.home_hits, errors: data.home_errors, label: homeLabel }
        });

        setText('bs-half-inning', data.inning_display);

        // Extract half from inning_display (e.g. "TOP 3rd" → "TOP")
        const display = data.inning_display || '';
        const halfMatch = display.match(/^(TOP|MID|BOT|END)/i);
        if (halfMatch) currentHalf = halfMatch[1].toUpperCase();

        updateCurrentPitcher();
    }

    function renderStatcrewBaseball(data) {
        statcrewData = data || {};
        if (data.away_team_color) applyAwayTeamColor(data.away_team_color);

        const venue = data.venue || {};
        if (venue.stadium || venue.location) {
            const parts = [venue.stadium, venue.location].filter(Boolean);
            setText('bs-venue-info', parts.join(' - ') || 'Live scoreboard feed');
        }

        if (venue.weather || venue.temp) {
            const weatherChip = document.getElementById('bs-weather-chip');
            if (weatherChip) weatherChip.style.display = 'block';
            setText('bs-weather', venue.weather || (venue.temp ? venue.temp + '\u00B0F' : '--'));
        }

        setText('bs-away-name', data.away_name || 'Away');
        setText('bs-home-name', data.home_name || 'Home');

        // Re-render pitcher and batter from StatCrew status element
        updateCurrentPitcher();
        updateCurrentBatter();
        updateDiamond();
    }

    function updateDiamond() {
        var first = document.getElementById('bs-base-1');
        var second = document.getElementById('bs-base-2');
        var third = document.getElementById('bs-base-3');
        if (!first) return;
        first.classList.toggle('occupied', !!(statcrewData.runner_first));
        second.classList.toggle('occupied', !!(statcrewData.runner_second));
        third.classList.toggle('occupied', !!(statcrewData.runner_third));
    }

    function updateCurrentPitcher() {
        // Batting team's opponent is pitching
        const batting = getBattingTeam();
        if (!batting) return;
        const prefix = batting === 'away' ? 'home' : 'away';
        const pName = statcrewData[prefix + '_pitcher_name'] || '--';
        const pUni = statcrewData[prefix + '_pitcher_uni'] || '';
        setText('bs-current-pitcher', formatPlayerName(pName) + (pUni ? ' #' + pUni : ''));

        const ip = statcrewData[prefix + '_pitcher_ip'] || '--';
        const so = statcrewData[prefix + '_pitcher_so'] || '--';
        const pitches = statcrewData[prefix + '_pitcher_pitches'] || '';
        let line = ip + ' IP | ' + so + ' K';
        if (pitches) line += ' | ' + pitches + ' P';
        setText('bs-pitcher-line', line);
    }

    function formatPlayerName(name) {
        if (!name) return '--';
        const parts = name.split(',');
        if (parts.length === 2) {
            const last = parts[0].trim();
            const first = parts[1].trim();
            return first + ' ' + last;
        }
        return name;
    }

    function updateCurrentBatter() {
        const name = statcrewData.current_batter_name || '';
        if (!name) {
            setText('bs-current-batter', '--');
            setText('bs-batter-line', '--');
            return;
        }

        // Normalize for matching: "Johnson Jr., RJ" → "JohnsonJr,RJ"
        const normalize = function(s) {
            return s.replace(/\./g, '').replace(/,\s+/g, ',').replace(/\s+/g, '');
        };
        const target = normalize(name);

        // Search batting team's roster for stats
        const batting = getBattingTeam();
        const batters = batting ? (statcrewData[batting + '_batters'] || []) : [];
        const batter = batters.find(function(b) {
            if (!b.name) return false;
            return normalize(b.name) === target || b.name === name;
        });

        if (batter) {
            setText('bs-current-batter', formatPlayerName(batter.name) + (batter.uni ? ' #' + batter.uni : ''));
            const ab = batter.ab || '--';
            const h = batter.h || '--';
            const rbi = batter.rbi || '--';
            const avg = batter.avg || '--';
            setText('bs-batter-line', h + '-' + ab + ' | ' + rbi + ' RBI | ' + avg);
        } else {
            setText('bs-current-batter', formatPlayerName(name));
            setText('bs-batter-line', '--');
        }
    }

    function fetchStatcrewBaseballData() {
        fetch('/get_statcrew_data/Baseball')
            .then(response => response.json())
            .then(data => renderStatcrewBaseball(data || {}))
            .catch(() => renderStatcrewBaseball({}));
    }

    function renderLinescoreBaseball(awayInnings, homeInnings, totals) {
        const table = document.getElementById('bs-linescore-table');
        if (!table) return;

        const isFilled = (value) => value !== undefined && value !== null && String(value).trim() !== '';
        const lastFilledIndex = (arr) => {
            for (let i = arr.length - 1; i >= 0; i -= 1) {
                if (isFilled(arr[i])) return i;
            }
            return -1;
        };

        const lastAway = lastFilledIndex(awayInnings);
        const lastHome = lastFilledIndex(homeInnings);
        const minInnings = 9;
        const inningCount = Math.max(minInnings, lastAway + 1, lastHome + 1, awayInnings.length, homeInnings.length);

        const renderRow = (label, innings, total) => {
            const cells = [];
            const teamLabel = total.label || label;
            cells.push(`<td class="team-row-label">${teamLabel}</td>`);
            for (let i = 0; i < inningCount; i += 1) {
                const value = formatValue(innings[i]);
                cells.push(`<td>${value}</td>`);
            }
            cells.push(`<td class="linescore-total">${formatValue(total.runs)}</td>`);
            cells.push(`<td class="linescore-total">${formatValue(total.hits)}</td>`);
            cells.push(`<td class="linescore-total">${formatValue(total.errors)}</td>`);
            return `<tr>${cells.join('')}</tr>`;
        };

        const headers = [''].concat(
            Array.from({ length: inningCount }, (_, idx) => `${idx + 1}`),
            ['R', 'H', 'E']
        );

        const headerCells = headers.map((label, index) => {
            if (index >= headers.length - 3 && label) {
                return `<th class="linescore-label">${label}</th>`;
            }
            return `<th>${label}</th>`;
        }).join('');

        table.innerHTML = `
            <table class="table-grid">
                <thead><tr>${headerCells}</tr></thead>
                <tbody>
                    ${renderRow('Away', awayInnings, totals.away)}
                    ${renderRow('Home', homeInnings, totals.home)}
                </tbody>
            </table>
        `;
    }

    function roundToTenth(val) {
        if (val === undefined || val === null || val === '' || val === 'n/a') return 'n/a';
        const num = parseFloat(val);
        if (isNaN(num)) return val;
        return Math.round(num * 10) / 10;
    }

    function renderTrackmanBaseball(data) {
        setText('bs-tm-pitch-speed', roundToTenth(data.pitch_speed));
        setText('bs-tm-spin-rate', roundToTenth(data.spin_rate));
        setText('bs-tm-exit-velocity', roundToTenth(data.hit_exit_velocity));
        setText('bs-tm-launch-angle', roundToTenth(data.hit_launch_angle));
        setText('bs-tm-distance', roundToTenth(data.hit_distance));

        updateStrikeZone('bs-zone-dot', 'bs-zone-readout', data, {
            zone: { minX: -0.83, maxX: 0.83, minV: 1.5, maxV: 3.3775 },
            margin: 1.0
            // TrackMan X is already centered at 0 (center of plate)
            // No offset or scale adjustment needed
        });
    }

    function renderTrackmanConfigBaseball(config) {
        const status = config.error
            ? 'error'
            : (config.enabled ? (config.running ? 'live' : 'idle') : 'disabled');
        setText('bs-tm-status', status);
        document.getElementById('bs-trackman-port').value = config.port || '';
        document.getElementById('bs-trackman-feed-type').value = config.feed_type || 'broadcast';
        document.getElementById('bs-trackman-enabled').value = config.enabled ? 'true' : 'false';
    }

    function loadTrackmanBaseballConfig() {
        fetch('/trackman_config/Baseball')
            .then(response => response.json())
            .then(data => renderTrackmanConfigBaseball(data || {}))
            .catch(() => renderTrackmanConfigBaseball({ enabled: false }));
    }

    function bindTrackmanBaseballDefaults() {
        const portInput = document.getElementById('bs-trackman-port');
        const feedSelect = document.getElementById('bs-trackman-feed-type');
        const applyDefault = () => {
            if (!portInput.value) {
                portInput.value = feedSelect.value === 'scoreboard' ? '20999' : '20998';
            }
        };
        feedSelect.addEventListener('change', applyDefault);
        applyDefault();
    }

    function submitTrackmanBaseballConfig(event) {
        event.preventDefault();
        const port = parseInt(document.getElementById('bs-trackman-port').value, 10);
        const feedType = document.getElementById('bs-trackman-feed-type').value;
        const enabled = document.getElementById('bs-trackman-enabled').value === 'true';
        fetch('/trackman_config/Baseball', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ port: port, feed_type: feedType, enabled: enabled })
        })
            .then(response => {
                if (!response.ok) return response.json().then(data => { throw data; });
                return response.json();
            })
            .then(data => renderTrackmanConfigBaseball(data || {}))
            .catch(error => renderTrackmanConfigBaseball({ enabled: false, error: error.error || 'error' }));
    }

    function fetchTrackmanBaseballData() {
        fetch('/get_trackman_data/Baseball')
            .then(response => response.json())
            .then(data => renderTrackmanBaseball(data || {}))
            .catch(() => renderTrackmanBaseball({}));
    }

    function fetchBaseballData() {
        fetchData('Baseball');
    }

    fetchBaseballData();
    setInterval(fetchBaseballData, 1000);
    loadTrackmanBaseballConfig();
    fetchTrackmanBaseballData();
    setInterval(fetchTrackmanBaseballData, 1000);
    bindTrackmanBaseballDefaults();

    fetchStatcrewBaseballData();
    setInterval(fetchStatcrewBaseballData, 2000);

    document.getElementById('bs-trackman-form').addEventListener('submit', submitTrackmanBaseballConfig);

    loadStatcrewConfig('Baseball', 'bs');
    document.getElementById('bs-statcrew-form').addEventListener('submit', function(e) {
        submitStatcrewConfig(e, 'Baseball', 'bs');
    });

    document.addEventListener('dataFetched', function (event) {
        renderBaseball(event.detail || {});
    });
</script>
{% endblock %}
